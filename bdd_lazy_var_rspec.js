(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var prop=require("./symbol").for;var lazyVarsPropName=prop("__lazyVars");function defineGetter(context,varName,options){options=options||{};var accessorName=(options.getterPrefix?options.getterPrefix:"")+varName;var varContext=options.defineOn||context;var vars=varContext[lazyVarsPropName]||{};if(!varContext[lazyVarsPropName]){varContext[lazyVarsPropName]=vars}if(accessorName in vars){return}if(accessorName in varContext){throw new Error(['Cannot create lazy variable "',varName,'" as variable with the same name exists on the provided context'].join(""))}vars[accessorName]=true;Object.defineProperty(varContext,accessorName,{configurable:true,get:function(){return context.get(varName)}})}module.exports=defineGetter},{"./symbol":8}],2:[function(require,module,exports){var lazyVar=require("./lazy_var");var Variable=require("./variable");module.exports=function(context,tracker,options){var ui={};ui.subject=function(name,definition){if(arguments.length===1){return ui.def("subject",name)}else if(arguments.length===2){return ui.def([name,"subject"],definition)}return ui.get("subject")};ui.get=function(varName){return Variable.evaluate(varName,{in:tracker.currentContext()})};ui.def=function(varName,definition){var suite=tracker.currentlyDefinedSuite();if(Array.isArray(varName)){ui.def(varName[0],definition);return defineAliasesFor(suite,varName[0],varName.slice(1))}lazyVar.register(suite.ctx,varName,definition,tracker.currentContext);detectParentDeclarationFor(suite,varName)};ui.get.definitionOf=ui.get.variable=function(varName){return ui.get.bind(ui,varName)};function detectParentDeclarationFor(suite,varName){if(suite.parent&&lazyVar.isDefined(suite.parent.ctx,varName)){lazyVar.metadataFor(suite.ctx,varName).parent=suite.parent.ctx}if(typeof options.onDefineVariable==="function"){options.onDefineVariable(suite,varName,context)}}function defineAliasesFor(suite,varName,aliases){aliases.forEach(function(alias){lazyVar.registerAlias(suite.ctx,varName,alias);detectParentDeclarationFor(suite,alias)})}return ui}},{"./lazy_var":5,"./variable":9}],3:[function(require,module,exports){(function(global){var Mocha=typeof window!=="undefined"?window["Mocha"]:typeof global!=="undefined"?global["Mocha"]:null;var createLazyVarInterface=require("../interface");var createTracker=require("../suite_tracker");function addInterface(rootSuite,tracker,options){rootSuite.on("pre-require",function(context){var ui=createLazyVarInterface(context,tracker,options);var describe=context.describe;context.def=ui.def;context.get=ui.get;context.subject=ui.subject;context.describe=tracker.wrapSuite(describe);context.describe.skip=tracker.wrapSuite(describe.skip);context.describe.only=tracker.wrapSuite(describe.only);context.context=context.describe;context.context.only=context.describe.only;context.xdescribe=context.xcontext=context.context.skip=context.describe.skip})}module.exports={createUi:function(name,options){var config=options||{};var buildTracker=config.createTracker||createTracker;config.inheritUi=config.inheritUi||"bdd";return Mocha.interfaces[name]=function(rootSuite){Mocha.interfaces[config.inheritUi](rootSuite);return addInterface(rootSuite,buildTracker({rootSuite:rootSuite}),config)}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../interface":2,"../suite_tracker":6}],4:[function(require,module,exports){var interfaceBuilder=require("../mocha");var defineGetterOnce=require("../../define_var");var createRspecTracker=require("../../suite_tracker/rspec");module.exports=interfaceBuilder.createUi("bdd-lazy-var/rspec",{createTracker:createRspecTracker,onDefineVariable:function(suite,varName,context){defineGetterOnce(context,varName,{getterPrefix:"$"})}})},{"../../define_var":1,"../../suite_tracker/rspec":7,"../mocha":3}],5:[function(require,module,exports){var lazyVarsPropName=require("./symbol").for("__lazyVars");function VariableMetadata(definition,thisContext){this.value=definition;this.parent=null;this.aliases=null;if(typeof thisContext==="function"){Object.defineProperty(this,"context",{get:thisContext})}else{this.context=thisContext}}VariableMetadata.prototype.addAlias=function(name){this.aliases=this.aliases||{};this.aliases[name]=true};VariableMetadata.prototype.hasAlias=function(name){return this.aliases&&this.aliases[name]};VariableMetadata.prototype.buildAliasMetadata=function(aliasName){var aliasMetadata=new VariableMetadata(null,null);aliasMetadata.aliases=this.aliases;this.addAlias(aliasName);return aliasMetadata};var lazyVar={register:function(context,name,definition,thisContext){var hasOwnVariable=context.hasOwnProperty(name)&&context.hasOwnProperty(lazyVarsPropName);if(hasOwnVariable&&lazyVar.isDefined(context,name)){throw new Error('Cannot define "'+name+'" variable twice in the same suite.')}var metadata=lazyVar.metadataFor(context);metadata.defs[name]=new VariableMetadata(definition,thisContext||context);lazyVar.defineProperty(context,name,metadata)},metadataFor:function(context,varName){if(!context.hasOwnProperty(lazyVarsPropName)){var lazyVarsInPrototype=context[lazyVarsPropName]?context[lazyVarsPropName].defs:null;context[lazyVarsPropName]={defs:Object.create(lazyVarsInPrototype),created:{}}}return arguments.length===2?context[lazyVarsPropName].defs[varName]:context[lazyVarsPropName]},defineProperty:function(context,name,metadata){Object.defineProperty(context,name,{configurable:true,get:function(){if(!metadata.created.hasOwnProperty(name)){var definition=metadata.defs[name];var value=definition.value;metadata.created[name]=typeof value==="function"?value.call(definition.context):value}return metadata.created[name]}})},registerAlias:function(context,varName,aliasName){var metadata=lazyVar.metadataFor(context);metadata.defs[aliasName]=metadata.defs[varName].buildAliasMetadata(aliasName);metadata.defs[aliasName].addAlias(varName);Object.defineProperty(context,aliasName,{get:function(){return this[varName]}})},isDefined:function(context,name){var hasLazyVars=context&&context[lazyVarsPropName];return!!(hasLazyVars&&context[lazyVarsPropName].defs[name])},cleanUp:function(context){if(context.hasOwnProperty(lazyVarsPropName)){context[lazyVarsPropName].created={}}}};module.exports=lazyVar},{"./symbol":8}],6:[function(require,module,exports){(function(global){var lazyVar=require("./lazy_var");function createOptions(options){return{setupSuite:options.setupSuite||global.before,teardownSuite:options.teardownSuite||global.after,setup:options.setup||global.beforeEach,teardown:options.teardown||global.afterEach}}module.exports=function createSuiteTracker(config){var state={currentlyDefinedSuite:config.rootSuite};var options;return{cleanUp:function(){lazyVar.cleanUp(this)},registerSuite:function(){state.prevTestContext=state.currentTestContext||null;state.currentTestContext=this},currentContext:function(){return state.currentTestContext},currentlyDefinedSuite:function(){return state.currentlyDefinedSuite},cleanUpAndRestorePrev:function(){state.currentTestContext=state.prevTestContext;lazyVar.cleanUp(this)},wrapSuite:function(fn){var self=this;return function detectSuite(title,runTests){return fn(title,function(){var previousDefinedSuite=state.currentlyDefinedSuite;state.currentlyDefinedSuite=this;options=options||createOptions(config);self.track(runTests,this,arguments,options);state.currentlyDefinedSuite=previousDefinedSuite})}},track:function(runTests,suite,args,options){options.setupSuite(this.registerSuite);options.setup(this.registerSuite);options.teardown(this.registerSuite);options.teardownSuite(this.registerSuite);runTests.apply(suite,args);options.setupSuite(this.cleanUp);options.teardown(this.cleanUp);options.teardownSuite(this.cleanUp)}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lazy_var":5}],7:[function(require,module,exports){var createTracker=require("../suite_tracker");module.exports=function createRspecTracker(config){var tracker=createTracker(config);tracker.track=function(runTests,suite,args,options){options.setupSuite(tracker.registerSuite);runTests.apply(suite,args);options.setupSuite(tracker.cleanUp);options.teardown(tracker.cleanUp);options.teardownSuite(tracker.cleanUpAndRestorePrev)};return tracker}},{"../suite_tracker":6}],8:[function(require,module,exports){var indentity=function(value){return value};module.exports={for:typeof Symbol==="undefined"?indentity:Symbol.for}},{}],9:[function(require,module,exports){var lazyVar=require("./lazy_var");var Symbol=require("./symbol");var CURRENTLY_RETRIEVED_VAR_FIELD=Symbol.for("__currentVariableStack");function Variable(varName,context){this.name=varName;this.context=context;this.ownContext=context}Variable.prototype.isSame=function(anotherVarName){return this.name&&(this.name===anotherVarName||lazyVar.metadataFor(this.ownContext,this.name).hasAlias(anotherVarName))};Variable.prototype.value=function(){return this.context[this.name]};Variable.prototype.addToStack=function(){this.context[CURRENTLY_RETRIEVED_VAR_FIELD]=this.context[CURRENTLY_RETRIEVED_VAR_FIELD]||[];this.context[CURRENTLY_RETRIEVED_VAR_FIELD].push(this);return this};Variable.prototype.release=function(){this.context[CURRENTLY_RETRIEVED_VAR_FIELD].pop()};Variable.prototype.valueInParentContext=function(varOrAliasName){var prevContext=this.context;try{this.context=this.getParentContextFor(varOrAliasName);return this.context[varOrAliasName]}finally{this.context=prevContext}};Variable.prototype.getParentContextFor=function(varName){var metadata=lazyVar.metadataFor(this.context,varName);if(!metadata||!metadata.parent){throw new Error('Unknown parent variable "'+varName+'".')}return metadata.parent};Variable.EMPTY=new Variable(null,null);Variable.allocate=function(varName,options){var variable=new this(varName,options["in"]);return variable.addToStack()};Variable.evaluate=function(varName,options){var variable=Variable.fromStack(options["in"]);if(variable.isSame(varName)){return variable.valueInParentContext(varName)}try{variable=Variable.allocate(varName,options);return variable.value()}finally{variable.release()}};Variable.fromStack=function(context){return last(context[CURRENTLY_RETRIEVED_VAR_FIELD])||Variable.EMPTY};function last(array){return array?array[array.length-1]:null}module.exports=Variable},{"./lazy_var":5,"./symbol":8}],10:[function(require,module,exports){module.exports=require("./lib/interface/mocha/rspec")},{"./lib/interface/mocha/rspec":4}]},{},[10]);
